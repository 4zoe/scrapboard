<script>
const TARGET_URL = 'https://data-asg.goldprice.org/dbXRates/USD';
const RATES_API_URL = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(TARGET_URL);

const OZ_TO_GRAM = 31.1035;
const GRAM_TO_KG = 1000;
const TOLA_TO_GRAM = 11.66;

// Purities
const PURITY_24K = 1.00;
const PURITY_22K = 0.9167;
const PURITY_21K = 0.8750;
const PURITY_18K = 0.7500;
const PURITY_14K = 14 / 24;   // 0.583333...
const PURITY_10K = 10 / 24;   // 0.416666...

fetch(RATES_API_URL)
  .then(r => r.json())
  .then(apiResponse => {
    const collection = {};

    apiResponse.items.forEach(item => {
      const currency = item.curr;
      const goldOZ = item.xauPrice;
      const silverOZ = item.xagPrice;

      const goldG = goldOZ / OZ_TO_GRAM;
      const goldKG = goldG * GRAM_TO_KG;
      const goldTola = goldG * TOLA_TO_GRAM;

      const silverG = silverOZ / OZ_TO_GRAM;
      const silverKG = silverG * GRAM_TO_KG;
      const silverTola = silverG * TOLA_TO_GRAM;

      // helper to round numbers consistently
      const r2 = v => +v.toFixed(2);

      collection[currency] = {
        gold_rates: {
          Price_OZ: r2(goldOZ),
          Price_G: r2(goldG),
          Price_KG: r2(goldKG),
          Price_Tola: r2(goldTola),

          // karat prices per gram
          Price_24K_per_g: r2(goldG * PURITY_24K),
          Price_22K_per_g: r2(goldG * PURITY_22K),
          Price_21K_per_g: r2(goldG * PURITY_21K),
          Price_18K_per_g: r2(goldG * PURITY_18K),
          Price_14K_per_g: r2(goldG * PURITY_14K),
          Price_10K_per_g: r2(goldG * PURITY_10K),

          // karat prices per tola (optional)
          Price_24K_per_tola: r2(goldTola * PURITY_24K),
          Price_22K_per_tola: r2(goldTola * PURITY_22K),
          Price_21K_per_tola: r2(goldTola * PURITY_21K),
          Price_18K_per_tola: r2(goldTola * PURITY_18K),
          Price_14K_per_tola: r2(goldTola * PURITY_14K),
          Price_10K_per_tola: r2(goldTola * PURITY_10K)
        },
        silver_rates: {
          Price_OZ: r2(silverOZ),
          Price_G: r2(silverG),
          Price_KG: r2(silverKG),
          Price_Tola: r2(silverTola)
        }
      };
    });

    document.getElementById("output").textContent = JSON.stringify(collection, null, 2);
  })
  .catch(e => {
    document.getElementById("output").textContent = "Error: " + e.message;
  });
</script>
