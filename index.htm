<script>
const TARGET_URL = 'https://data-asg.goldprice.org/dbXRates/USD';
const PROXY = 'https://api.allorigins.win/get?url=' + encodeURIComponent(TARGET_URL);

fetch(PROXY)
  .then(res => {
    if (!res.ok) throw new Error('Network response was not ok: ' + res.status);
    return res.json();
  })
  .then(proxyData => {
    // allOrigins /get returns { contents: "..." }
    const text = proxyData.contents;
    const apiResponse = JSON.parse(text);
    if (!apiResponse.items) throw new Error('Unexpected API shape');
    const collection = {};
    apiResponse.items.forEach(item => {
      const currency = item.curr;
      const goldOZ = item.xauPrice;
      const silverOZ = item.xagPrice;
      const OZ_TO_GRAM = 31.1035;
      const TOLA_TO_GRAM = 11.66;
      const goldG = goldOZ / OZ_TO_GRAM;
      const silverG = silverOZ / OZ_TO_GRAM;
      collection[currency] = {
        gold_rates: {
          Price_OZ: +goldOZ.toFixed(2),
          Price_G: +goldG.toFixed(2)
        },
        silver_rates: {
          Price_OZ: +silverOZ.toFixed(2),
          Price_G: +silverG.toFixed(2)
        }
      };
    });
    document.getElementById("output").textContent = JSON.stringify(collection, null, 2);
  })
  .catch(err => {
    document.getElementById("output").textContent = "Error: " + err.message;
    console.error(err);
  });
</script>
